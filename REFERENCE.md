# Reference

<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

### Classes

#### Public Classes

* [`ha_adguard`](#ha_adguard): Manages AdGuard Home in high-availability configuration

#### Private Classes

* `ha_adguard::config`: Manages AdGuard Home configuration
* `ha_adguard::firewall`: Manages firewall rules for AdGuard Home
* `ha_adguard::install`: Installs AdGuard Home and adguardhome-sync binaries
* `ha_adguard::keepalived`: Manages Keepalived for VIP failover
* `ha_adguard::service`: Manages AdGuard Home systemd service
* `ha_adguard::sync`: Manages adguardhome-sync for configuration replication
* `ha_adguard::user`: Manages the AdGuard Home system user and group

## Classes

### <a name="ha_adguard"></a>`ha_adguard`

Copyright (C) 2026 James Evans

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.

This module installs and configures AdGuard Home with optional HA support
using Keepalived for VIP failover and adguardhome-sync for config replication.

#### Examples

##### Basic single-node installation

```puppet
class { 'ha_adguard':
  ensure => present,
}
```

##### HA cluster - primary node

```puppet
class { 'ha_adguard':
  ensure              => present,
  ha_enabled          => true,
  ha_role             => 'primary',
  cluster_nodes       => ['dns1.example.com', 'dns2.example.com'],
  keepalived_enabled  => true,
  vip_address         => '192.168.1.100',
  vrrp_priority       => 150,
}
```

##### HA cluster - replica node

```puppet
class { 'ha_adguard':
  ensure              => present,
  ha_enabled          => true,
  ha_role             => 'replica',
  cluster_nodes       => ['dns1.example.com', 'dns2.example.com'],
  keepalived_enabled  => true,
  vip_address         => '192.168.1.100',
  vrrp_priority       => 100,
  sync_enabled        => true,
  sync_origin_url     => 'http://dns1.example.com:3000',
  sync_password       => Sensitive('supersecret'),
}
```

#### Parameters

The following parameters are available in the `ha_adguard` class:

* [`ensure`](#-ha_adguard--ensure)
* [`adguard_version`](#-ha_adguard--adguard_version)
* [`adguard_download_url`](#-ha_adguard--adguard_download_url)
* [`install_dir`](#-ha_adguard--install_dir)
* [`config_dir`](#-ha_adguard--config_dir)
* [`work_dir`](#-ha_adguard--work_dir)
* [`user`](#-ha_adguard--user)
* [`group`](#-ha_adguard--group)
* [`uid`](#-ha_adguard--uid)
* [`gid`](#-ha_adguard--gid)
* [`adguard_config`](#-ha_adguard--adguard_config)
* [`bind_host`](#-ha_adguard--bind_host)
* [`bind_port`](#-ha_adguard--bind_port)
* [`dns_port`](#-ha_adguard--dns_port)
* [`upstream_dns`](#-ha_adguard--upstream_dns)
* [`enable_dnssec`](#-ha_adguard--enable_dnssec)
* [`enable_filtering`](#-ha_adguard--enable_filtering)
* [`ha_enabled`](#-ha_adguard--ha_enabled)
* [`ha_role`](#-ha_adguard--ha_role)
* [`cluster_nodes`](#-ha_adguard--cluster_nodes)
* [`keepalived_enabled`](#-ha_adguard--keepalived_enabled)
* [`vip_address`](#-ha_adguard--vip_address)
* [`vip_address_v6`](#-ha_adguard--vip_address_v6)
* [`vrrp_priority`](#-ha_adguard--vrrp_priority)
* [`vrrp_router_id`](#-ha_adguard--vrrp_router_id)
* [`vrrp_auth_pass`](#-ha_adguard--vrrp_auth_pass)
* [`vrrp_interface`](#-ha_adguard--vrrp_interface)
* [`health_check_interval`](#-ha_adguard--health_check_interval)
* [`health_check_timeout`](#-ha_adguard--health_check_timeout)
* [`sync_enabled`](#-ha_adguard--sync_enabled)
* [`sync_version`](#-ha_adguard--sync_version)
* [`sync_origin_url`](#-ha_adguard--sync_origin_url)
* [`sync_username`](#-ha_adguard--sync_username)
* [`sync_password`](#-ha_adguard--sync_password)
* [`sync_interval`](#-ha_adguard--sync_interval)
* [`sync_run_on_start`](#-ha_adguard--sync_run_on_start)
* [`sync_api_enabled`](#-ha_adguard--sync_api_enabled)
* [`sync_api_port`](#-ha_adguard--sync_api_port)
* [`sync_features`](#-ha_adguard--sync_features)
* [`manage_firewall`](#-ha_adguard--manage_firewall)
* [`firewall_provider`](#-ha_adguard--firewall_provider)
* [`manage_service`](#-ha_adguard--manage_service)
* [`service_ensure`](#-ha_adguard--service_ensure)
* [`service_enable`](#-ha_adguard--service_enable)

##### <a name="-ha_adguard--ensure"></a>`ensure`

Data type: `Enum['present', 'absent']`

Ensure state of the module (present or absent)

Default value: `'present'`

##### <a name="-ha_adguard--adguard_version"></a>`adguard_version`

Data type: `String[1]`

AdGuard Home version to install

Default value: `'0.107.52'`

##### <a name="-ha_adguard--adguard_download_url"></a>`adguard_download_url`

Data type: `String[1]`

Base URL for AdGuard Home downloads

Default value: `'https://github.com/AdguardTeam/AdGuardHome/releases/download'`

##### <a name="-ha_adguard--install_dir"></a>`install_dir`

Data type: `Stdlib::Absolutepath`

Installation directory for AdGuard Home

Default value: `'/opt/AdGuardHome'`

##### <a name="-ha_adguard--config_dir"></a>`config_dir`

Data type: `Stdlib::Absolutepath`

Configuration directory

Default value: `'/etc/adguardhome'`

##### <a name="-ha_adguard--work_dir"></a>`work_dir`

Data type: `Stdlib::Absolutepath`

Working directory for AdGuard Home data

Default value: `'/var/lib/adguardhome'`

##### <a name="-ha_adguard--user"></a>`user`

Data type: `String[1]`

System user for running AdGuard Home

Default value: `'adguard'`

##### <a name="-ha_adguard--group"></a>`group`

Data type: `String[1]`

System group for running AdGuard Home

Default value: `'adguard'`

##### <a name="-ha_adguard--uid"></a>`uid`

Data type: `Optional[Integer]`

User ID (optional, auto-assigned if undef)

Default value: `undef`

##### <a name="-ha_adguard--gid"></a>`gid`

Data type: `Optional[Integer]`

Group ID (optional, auto-assigned if undef)

Default value: `undef`

##### <a name="-ha_adguard--adguard_config"></a>`adguard_config`

Data type: `Hash`

Hash of additional AdGuard Home configuration (merged with defaults)

Default value: `{}`

##### <a name="-ha_adguard--bind_host"></a>`bind_host`

Data type: `Stdlib::IP::Address`

IP address to bind web UI

Default value: `'0.0.0.0'`

##### <a name="-ha_adguard--bind_port"></a>`bind_port`

Data type: `Stdlib::Port`

Port for web UI

Default value: `3000`

##### <a name="-ha_adguard--dns_port"></a>`dns_port`

Data type: `Stdlib::Port`

Port for DNS service

Default value: `53`

##### <a name="-ha_adguard--upstream_dns"></a>`upstream_dns`

Data type: `Array[String[1]]`

Array of upstream DNS servers

Default value:

```puppet
[
    '1.1.1.1',
    '1.0.0.1',
    '8.8.8.8',
    '8.8.4.4',
  ]
```

##### <a name="-ha_adguard--enable_dnssec"></a>`enable_dnssec`

Data type: `Boolean`

Enable DNSSEC validation

Default value: `true`

##### <a name="-ha_adguard--enable_filtering"></a>`enable_filtering`

Data type: `Boolean`

Enable DNS filtering

Default value: `true`

##### <a name="-ha_adguard--ha_enabled"></a>`ha_enabled`

Data type: `Boolean`

Enable high-availability mode

Default value: `false`

##### <a name="-ha_adguard--ha_role"></a>`ha_role`

Data type: `Enum['primary', 'replica']`

HA role (primary or replica)

Default value: `'replica'`

##### <a name="-ha_adguard--cluster_nodes"></a>`cluster_nodes`

Data type: `Array[String[1]]`

Array of cluster node FQDNs/IPs

Default value: `[]`

##### <a name="-ha_adguard--keepalived_enabled"></a>`keepalived_enabled`

Data type: `Boolean`

Enable Keepalived for VIP management

Default value: `false`

##### <a name="-ha_adguard--vip_address"></a>`vip_address`

Data type: `Optional[Stdlib::IP::Address]`

Virtual IP address (required if keepalived_enabled)

Default value: `undef`

##### <a name="-ha_adguard--vip_address_v6"></a>`vip_address_v6`

Data type: `Optional[Stdlib::IP::Address::V6::CIDR]`

IPv6 virtual IP address with prefix length (optional, e.g. fd00:1234:5678:1::10/64)

Default value: `undef`

##### <a name="-ha_adguard--vrrp_priority"></a>`vrrp_priority`

Data type: `Integer[0,255]`

VRRP priority (higher = preferred master). Primary nodes should use a higher
value (e.g., 150) than replica nodes (e.g., 100) to enable automatic failback.
Both nodes MUST have different priorities for proper failover/failback behavior.

Default value: `$ha_role ? { 'primary' => 150, 'replica' => 100`

##### <a name="-ha_adguard--vrrp_router_id"></a>`vrrp_router_id`

Data type: `Integer[1,255]`

VRRP router ID

Default value: `51`

##### <a name="-ha_adguard--vrrp_auth_pass"></a>`vrrp_auth_pass`

Data type: `String[1]`

VRRP authentication password

Default value: `'changeme'`

##### <a name="-ha_adguard--vrrp_interface"></a>`vrrp_interface`

Data type: `String[1]`

Network interface for VRRP

Default value: `'eth0'`

##### <a name="-ha_adguard--health_check_interval"></a>`health_check_interval`

Data type: `Integer[1]`

Health check interval in seconds

Default value: `2`

##### <a name="-ha_adguard--health_check_timeout"></a>`health_check_timeout`

Data type: `Integer[1]`

Health check timeout in seconds

Default value: `5`

##### <a name="-ha_adguard--sync_enabled"></a>`sync_enabled`

Data type: `Boolean`

Enable adguardhome-sync

Default value: `false`

##### <a name="-ha_adguard--sync_version"></a>`sync_version`

Data type: `String[1]`

adguardhome-sync version to install

Default value: `'0.6.15'`

##### <a name="-ha_adguard--sync_origin_url"></a>`sync_origin_url`

Data type: `Optional[Stdlib::HTTPUrl]`

Primary node URL for sync

Default value: `undef`

##### <a name="-ha_adguard--sync_username"></a>`sync_username`

Data type: `String[1]`

AdGuard Home username for sync

Default value: `'admin'`

##### <a name="-ha_adguard--sync_password"></a>`sync_password`

Data type: `Sensitive[String[1]]`

AdGuard Home password for sync (Sensitive type)

Default value: `Sensitive('changeme')`

##### <a name="-ha_adguard--sync_interval"></a>`sync_interval`

Data type: `Integer[1]`

Sync interval in seconds

Default value: `600`

##### <a name="-ha_adguard--sync_run_on_start"></a>`sync_run_on_start`

Data type: `Boolean`

Run sync immediately on service start

Default value: `true`

##### <a name="-ha_adguard--sync_api_enabled"></a>`sync_api_enabled`

Data type: `Boolean`

Enable sync API

Default value: `true`

##### <a name="-ha_adguard--sync_api_port"></a>`sync_api_port`

Data type: `Stdlib::Port`

Sync API port

Default value: `8080`

##### <a name="-ha_adguard--sync_features"></a>`sync_features`

Data type: `Array[String[1]]`

Array of features to synchronize

Default value:

```puppet
[
    'general_settings',
    'query_log_config',
    'stats_config',
    'client_settings',
    'services',
    'filters',
    'dhcp_server_config',
    'dns_config',
  ]
```

##### <a name="-ha_adguard--manage_firewall"></a>`manage_firewall`

Data type: `Boolean`

Manage firewall rules

Default value: `false`

##### <a name="-ha_adguard--firewall_provider"></a>`firewall_provider`

Data type: `Enum['firewalld', 'iptables']`

Firewall provider (firewalld or iptables)

Default value: `'firewalld'`

##### <a name="-ha_adguard--manage_service"></a>`manage_service`

Data type: `Boolean`

Manage AdGuard Home service

Default value: `true`

##### <a name="-ha_adguard--service_ensure"></a>`service_ensure`

Data type: `Stdlib::Ensure::Service`

Service ensure state

Default value: `'running'`

##### <a name="-ha_adguard--service_enable"></a>`service_enable`

Data type: `Boolean`

Enable service at boot

Default value: `true`

